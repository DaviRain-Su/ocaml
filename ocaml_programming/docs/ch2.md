# 2.2.3.1.æ‰‹åŠ¨åˆ›å»ºæ²™ä¸˜é¡¹ç›®

åˆ›å»ºä¸€ä¸ªduneçš„æ–‡ä»¶ `dune`ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```dune
(executable
 (name hello))
```

å®ƒå£°æ˜äº†ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¯ä»¥æ‰§è¡Œçš„ç¨‹åºï¼‰ï¼Œå…¶ä¸»æ–‡ä»¶æ˜¯ hello.ml ã€‚

å¦å¤–åˆ›å»ºä¸€ä¸ªåä¸º dune-project çš„æ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹å†…å®¹æ”¾å…¥å…¶ä¸­ï¼š

```dune
(lang dune 3.14)
```

æ‚¨æƒ³è¦ä½¿ç”¨ Dune ç¼–è¯‘çš„æ¯ä¸ªæºä»£ç æ ‘çš„æ ¹ç›®å½•ä¸­éƒ½éœ€è¦æ­¤é¡¹ç›®æ–‡ä»¶ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæºæ ‘çš„æ¯ä¸ªå­ç›®å½•ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ª dune æ–‡ä»¶ï¼Œä½†æ ¹ç›®å½•ä¸‹åªæœ‰ä¸€ä¸ª dune-project æ–‡ä»¶ã€‚

ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º hello.ml çš„æ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹å†…å®¹æ”¾å…¥å…¶ä¸­ï¼š

```ocaml
let () = print_endline "Hello, world!"
```

ç„¶åç»ˆç«¯è¿è¡Œ

```shell
dune build hello.exe
```

è¯·æ³¨æ„ï¼Œ .exe æ‰©å±•ååœ¨ Dune çš„æ‰€æœ‰å¹³å°ä¸Šä½¿ç”¨ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨ Windows ä¸Šã€‚è¿™ä¼šå¯¼è‡´ Dune æ„å»ºæœ¬æœºå¯æ‰§è¡Œæ–‡ä»¶è€Œä¸æ˜¯å­—èŠ‚ç å¯æ‰§è¡Œæ–‡ä»¶ã€‚

Dune å°†åˆ›å»ºä¸€ä¸ªç›®å½• _build å¹¶åœ¨å…¶ä¸­ç¼–è¯‘æˆ‘ä»¬çš„ç¨‹åºã€‚è¿™æ˜¯æ„å»ºç³»ç»Ÿç›¸å¯¹äºç›´æ¥è¿è¡Œç¼–è¯‘å™¨çš„å¥½å¤„ä¹‹ä¸€ï¼šå®ƒä»¬ä¸ä¼šç”¨ä¸€å †ç”Ÿæˆçš„æ–‡ä»¶æ±¡æŸ“æºç›®å½•ï¼Œè€Œæ˜¯åœ¨å•ç‹¬çš„ç›®å½•ä¸­å¹²å‡€åœ°åˆ›å»ºå®ƒä»¬ã€‚ _build å†…éƒ¨æœ‰è®¸å¤šç”± Dune åˆ›å»ºçš„æ–‡ä»¶ã€‚æˆ‘ä»¬çš„å¯æ‰§è¡Œæ–‡ä»¶è¢«åŸ‹è—åœ¨ä¸‹é¢å‡ å±‚ï¼š

```shell
_build/default/hello.exe
Hello, world!
```

ä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œ

```shell
dune exec ./hello.exe
Hello world!
```

æ¸…ç†ğŸ§¹ä»£ç 

```shell
dune clean
```

è¿™å°†åˆ é™¤ _build ç›®å½•ï¼Œåªç•™ä¸‹æºä»£ç ã€‚

> ä¸è¦ç¼–è¾‘ _build ç›®å½•ä¸­çš„ä»»ä½•æ–‡ä»¶ã€‚å¦‚æœæ‚¨åœ¨å°è¯•ä¿å­˜åªè¯»æ–‡ä»¶æ—¶é‡åˆ°é”™è¯¯ï¼Œåˆ™æ‚¨å¯èƒ½æ­£åœ¨å°è¯•ç¼–è¾‘ _build ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚

## 2.2.3.2.è‡ªåŠ¨åˆ›å»ºæ²™ä¸˜é¡¹ç›®

Dune è¿˜å¯ä»¥ä¸ºæ‚¨åˆ›å»ºé¡¹ç›®ã€‚åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```shell
$ dune init project calculator
$ cd calculator
$ code .
```

è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º calculator çš„ç›®å½•ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º dune-project çš„æ–‡ä»¶å’Œä¸€ä¸ªåä¸º dune çš„æ–‡ä»¶ã€‚è¿™ä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹ä¸æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­æ‰‹åŠ¨åˆ›å»ºçš„å†…å®¹ç›¸åŒã€‚

```shell
$ dune exec bin/main.exe
```

å®ƒå°†æ‰“å° Hello, World!

## 2.2.3.3.è¿ç»­è¿è¡Œæ²™ä¸˜

Dune è¿˜å¯ä»¥åœ¨åå°è¿è¡Œä»¥ç›‘è§†æºæ–‡ä»¶çš„æ›´æ”¹å¹¶è‡ªåŠ¨é‡æ–°æ„å»ºé¡¹ç›®ã€‚åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```shell
$ dune build --watch
```

Dune å°†å“åº”å®ƒæ­£åœ¨ç­‰å¾…æ–‡ä»¶ç³»ç»Ÿæ›´æ”¹ã€‚

## 2.3.1.åŸºæœ¬ç±»å‹å’Œå€¼

OCaml ä¸ä¼šè‡ªåŠ¨åœ¨ int å’Œ float ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚å¦‚æœæ‚¨æƒ³è¿›è¡Œè½¬æ¢ï¼Œæœ‰ä¸¤ä¸ªå†…ç½®å‡½æ•°å¯ç”¨äºæ­¤ç›®çš„ï¼š int_of_float å’Œ float_of_int ã€‚

```ocaml
let x = 3.14 in
let y = int_of_float x in
let z = float_of_int 42 in
```

æ‚¨å¯ä»¥ä½¿ç”¨ char_of_int å’Œ int_of_char å°†å­—ç¬¦ä¸æ•´æ•°ç›¸äº’è½¬æ¢ã€‚

```ocaml
let x = char_of_int 65 in
let y = int_of_char 'A' in
```


å¯¹äºä¸‰ç§åŸºæœ¬ç±»å‹ï¼Œæœ‰å†…ç½®å‡½æ•°ï¼š string_of_int ã€ string_of_float ã€ string_of_bool

```ocaml
let x = string_of_int 42 in
let y = string_of_float 3.14 in
let z = string_of_bool true in
```

å¯¹äºç›¸åŒçš„ä¸‰ç§åŸºæœ¬ç±»å‹ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæœ‰å†…ç½®å‡½æ•°å¯ä»¥ä»å­—ç¬¦ä¸²è¿›è¡Œè½¬æ¢ï¼š int_of_string ã€ float_of_string å’Œ bool_of_string ã€‚

```ocaml
let x = int_of_string "42" in
let y = float_of_string "3.14" in
let z = bool_of_string "true" in
```

æ²¡æœ‰ char_of_string ï¼Œä½†å¯ä»¥é€šè¿‡åŸºäº 0 çš„ç´¢å¼•æ¥è®¿é—®å­—ç¬¦ä¸²çš„å„ä¸ªå­—ç¬¦ã€‚ç´¢å¼•è¿ç®—ç¬¦ç”¨ç‚¹å’Œæ–¹æ‹¬å·ç¼–å†™

```ocaml
let x = "hello".[1];;
```

##  2.3.2.æ›´å¤šè¿ç®—ç¬¦

OCaml ä¸­æœ‰ä¸¤ä¸ªç›¸ç­‰è¿ç®—ç¬¦ = å’Œ == ï¼Œä»¥åŠç›¸åº”çš„ä¸ç­‰è¿ç®—ç¬¦ <> å’Œ != ã€‚è¿ç®—ç¬¦ = å’Œ <> æ£€æŸ¥ç»“æ„ç›¸ç­‰æ€§ï¼Œè€Œ == å’Œ != æ£€æŸ¥ç‰©ç†ç›¸ç­‰æ€§ã€‚

åœ¨æˆ‘ä»¬ç ”ç©¶ OCaml çš„å‘½ä»¤å¼åŠŸèƒ½ä¹‹å‰ï¼Œå®ƒä»¬ä¹‹é—´çš„å·®å¼‚å¾ˆéš¾è§£é‡Šã€‚å¦‚æœæ‚¨ç°åœ¨å¥½å¥‡ï¼Œè¯·å‚é˜… Stdlib.(==) çš„æ–‡æ¡£ã€‚

## 2.3.3.æ–­è¨€

è¡¨è¾¾å¼ assert e è®¡ç®— e ã€‚å¦‚æœç»“æœæ˜¯ true ï¼Œåˆ™ä¸ä¼šå†å‘ç”Ÿä»»ä½•äº‹æƒ…ï¼Œå¹¶ä¸”æ•´ä¸ªè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸ºä¸€ä¸ªç§°ä¸ºå•ä½çš„ç‰¹æ®Šå€¼ã€‚å•ä½å€¼å†™ä½œ () ï¼Œå…¶ç±»å‹ä¸º unit ã€‚ä½†å¦‚æœç»“æœæ˜¯ false ï¼Œåˆ™ä¼šå¼•å‘å¼‚å¸¸ã€‚

```ocaml
let x = 42 in
assert (x = 42);
assert (x = 43); (* raises an exception *)
```

## 2.3.4.ifè¡¨è¾¾å¼


æ— è®ºæ‚¨æ˜¯ç¼–å†™å•ä¸ª if è¡¨è¾¾å¼è¿˜æ˜¯é«˜åº¦åµŒå¥—çš„ if è¡¨è¾¾å¼ï¼Œæ‚¨éƒ½åº”è¯¥å°†æœ€ç»ˆçš„ else è§†ä¸ºå¼ºåˆ¶æ€§çš„ã€‚å¦‚æœçœç•¥å®ƒï¼Œæ‚¨å¯èƒ½ä¼šæ”¶åˆ°ä¸€æ¡ç›®å‰éš¾ä»¥ç†è§£çš„é”™è¯¯æ¶ˆæ¯ã€‚

```ocaml
if e1 then e2 else e3
```

é™æ€è¯­ä¹‰ã€‚ if è¡¨è¾¾å¼çš„é™æ€è¯­ä¹‰ï¼š

- å¦‚æœ e1 å…·æœ‰ç±»å‹ bool ä¸” e2 å…·æœ‰ç±»å‹ t ä¸” e3 å…·æœ‰ç±»å‹ t é‚£ä¹ˆ if e1 then e2 else e3 çš„ç±»å‹ä¸º t

æˆ‘ä»¬æ˜¯å¦è°ƒç”¨å‡½æ•°çš„å‚æ•° x è¿˜æ˜¯  y æœ¬è´¨ä¸Šå¹¶ä¸é‡è¦ï¼›ä¸ç®¡æ€æ ·ï¼Œå®ƒä»ç„¶æ˜¯å¹³æ–¹å‡½æ•°ã€‚å› æ­¤ï¼Œåœ¨ç¨‹åºä¸­ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°åº”è¯¥æ˜¯ç›¸åŒçš„ï¼š

```ocaml
let f x = x * x
let f y = y * y
```

alpha ç­‰ä»·ï¼šä¸¤ä¸ªå‡½æ•°åœ¨å˜é‡é‡å‘½åä¹‹å‰æ˜¯ç­‰ä»·çš„

æœ‰ä¸€ä¸ªæœ¯è¯­é€šå¸¸ç”¨äºæè¿°è¿™ç§ç°è±¡ï¼šå˜é‡çš„æ–°ç»‘å®šä¼šéšè—å˜é‡åç§°çš„ä»»ä½•æ—§ç»‘å®šã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œå°±å¥½åƒæ–°ç»‘å®šæš‚æ—¶åœ¨æ—§ç»‘å®šä¸ŠæŠ•ä¸‹äº†é˜´å½±ã€‚ä½†æœ€ç»ˆï¼Œéšç€é˜´å½±æ¶ˆé€€ï¼Œæ—§çš„ç»‘å®šå¯èƒ½ä¼šé‡æ–°å‡ºç°ã€‚

æ€»è€Œè¨€ä¹‹ï¼Œæ¯ä¸ª let å®šä¹‰éƒ½ç»‘å®šä¸€ä¸ªå…¨æ–°çš„å˜é‡ã€‚å¦‚æœæ–°å˜é‡ç¢°å·§ä¸æ—§å˜é‡åŒåï¼Œåˆ™æ–°å˜é‡ä¼šæš‚æ—¶éšè—æ—§å˜é‡ã€‚ä½†æ—§å˜é‡ä»ç„¶å­˜åœ¨ï¼Œå¹¶ä¸”å®ƒçš„å€¼æ˜¯ä¸å¯å˜çš„ï¼šå®ƒæ°¸è¿œä¸ä¼šæ”¹å˜ã€‚å› æ­¤ï¼Œå°½ç®¡ let è¡¨è¾¾å¼è¡¨é¢ä¸Šçœ‹èµ·æ¥åƒå‘½ä»¤å¼è¯­è¨€ä¸­çš„èµ‹å€¼è¯­å¥ï¼Œä½†å®ƒä»¬å®é™…ä¸Šæ˜¯å®Œå…¨ä¸åŒçš„ã€‚

## 2.4 å‡½æ•°

éé€’å½’å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š

```ocaml
let f x = ...
```

é€’å½’å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š

```ocaml
let rec f x = ...
```

åŒºåˆ«åªæ˜¯ rec å…³é”®å­—ã€‚æ˜ç¡®å¿…é¡»æ·»åŠ å…³é”®å­—æ‰èƒ½ä½¿å‡½æ•°é€’å½’å¯èƒ½æœ‰ç‚¹ä»¤äººæƒŠè®¶ï¼Œå› ä¸ºå¤§å¤šæ•°è¯­è¨€é»˜è®¤æƒ…å†µä¸‹éƒ½å‡è®¾å®ƒä»¬æ˜¯é€’å½’çš„ã€‚ä½† OCaml å¹¶æ²¡æœ‰åšå‡ºè¿™æ ·çš„å‡è®¾ã€‚

```ocaml
(** [fact n] is [n!].
    Requires: [n >= 0]. *)
let rec fact n = if n = 0 then 1 else n * fact (n - 1)
```

å‡½æ•°ä¸Šæ–¹æä¾›äº†è§„èŒƒæ³¨é‡Šæ¥è®°å½•å‡½æ•°çš„å‰ç½®æ¡ä»¶ ( Requires ) å’Œåç½®æ¡ä»¶ ( is )ã€‚

å½“æˆ‘ä»¬ä¸º x å’Œ y ç¼–å†™ç±»å‹æ³¨é‡Šæ—¶ï¼Œæ‹¬å·æ˜¯å¿…éœ€çš„ã€‚æˆ‘ä»¬é€šå¸¸ä¼šçœç•¥è¿™äº›æ³¨é‡Šï¼Œå› ä¸ºè®©ç¼–è¯‘å™¨æ¨æ–­å®ƒä»¬æ›´ç®€å•ã€‚æœ‰æ—¶æ‚¨ä¼šæƒ³è¦æ˜¾å¼åœ°å†™ä¸‹ç±»å‹ã€‚
ä¸€ä¸ªç‰¹åˆ«æœ‰ç”¨çš„æ—¶åˆ»æ˜¯å½“æ‚¨ä»ç¼–è¯‘å™¨ä¸­æ”¶åˆ°æ‚¨ä¸ç†è§£çš„ç±»å‹é”™è¯¯æ—¶ã€‚æ˜¾å¼æ³¨é‡Šç±»å‹å¯ä»¥å¸®åŠ©è°ƒè¯•æ­¤ç±»é”™è¯¯æ¶ˆæ¯ã€‚

å¯ä»¥ä½¿ç”¨ and å…³é”®å­—å®šä¹‰ç›¸äº’é€’å½’å‡½æ•°ï¼š

```
let rec f x1 ... xn = e1
and g y1 ... yn = e2
```

```ocaml
(** [even n] is whether [n] is even.
    Requires: [n >= 0]. *)
let rec even n =
  n = 0 || odd (n - 1)

(** [odd n] is whether [n] is odd.
    Requires: [n >= 0]. *)
and odd n =
  n <> 0 && even (n - 1);;
```

è¯·æ³¨æ„é€’å½’å‡½æ•°çš„ç±»å‹æ£€æŸ¥è§„åˆ™å¦‚ä½•å‡è®¾å‡½æ•°æ ‡è¯†ç¬¦ f å…·æœ‰ç‰¹å®šç±»å‹ï¼Œç„¶åæ£€æŸ¥å‡½æ•°ä½“åœ¨è¯¥å‡è®¾ä¸‹æ˜¯å¦ç±»å‹æ­£ç¡®ã€‚è¿™æ˜¯å› ä¸º f ä½äºå‡½æ•°ä½“æœ¬èº«çš„èŒƒå›´å†…ï¼ˆå°±åƒå‚æ•°ä½äºèŒƒå›´å†…ä¸€æ ·ï¼‰ã€‚

è¿™ä¸ªæ¦‚å¿µç¡®å®æœ‰äº›å¤æ‚ï¼Œè®©æˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š

1. é€’å½’å‡½æ•°çš„æœ¬è´¨ï¼š
   é€’å½’å‡½æ•°æ˜¯åœ¨å…¶è‡ªèº«å®šä¹‰ä¸­è°ƒç”¨è‡ªå·±çš„å‡½æ•°ã€‚è¿™æ„å‘³ç€å‡½æ•°ä½“å†…éƒ¨ä¼šå¼•ç”¨åˆ°å‡½æ•°æœ¬èº«ã€‚

2. ç±»å‹æ£€æŸ¥çš„æŒ‘æˆ˜ï¼š
   å½“ç¼–è¯‘å™¨æˆ–ç±»å‹æ£€æŸ¥å™¨é‡åˆ°é€’å½’å‡½æ•°æ—¶ï¼Œå®ƒé¢ä¸´ä¸€ä¸ªæŒ‘æˆ˜ï¼šåœ¨æ£€æŸ¥å‡½æ•°ä½“ä¹‹å‰ï¼Œå®ƒéœ€è¦çŸ¥é“å‡½æ•°çš„ç±»å‹ï¼Œä½†å‡½æ•°çš„ç±»å‹åˆä¾èµ–äºå…¶å‡½æ•°ä½“ã€‚

3. ç±»å‹æ£€æŸ¥çš„ç­–ç•¥ï¼š
   ä¸ºäº†è§£å†³è¿™ä¸ªå¾ªç¯ä¾èµ–ï¼Œç±»å‹ç³»ç»Ÿé‡‡ç”¨äº†ä¸€ç§ç‰¹æ®Šçš„ç­–ç•¥ï¼š

   a. å‡è®¾ï¼šé¦–å…ˆï¼Œå®ƒå‡è®¾å‡½æ•°å…·æœ‰æŸä¸ªç‰¹å®šçš„ç±»å‹ã€‚
   b. éªŒè¯ï¼šç„¶åï¼Œåœ¨è¿™ä¸ªå‡è®¾çš„åŸºç¡€ä¸Šæ£€æŸ¥å‡½æ•°ä½“ã€‚
   c. ä¸€è‡´æ€§ï¼šå¦‚æœå‡½æ•°ä½“åœ¨è¿™ä¸ªå‡è®¾ä¸‹ç±»å‹æ­£ç¡®ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡è®¾å°±è¢«è¯æ˜æ˜¯æœ‰æ•ˆçš„ã€‚

4. å‡½æ•°æ ‡è¯†ç¬¦çš„ä½œç”¨åŸŸï¼š
   åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå‡½æ•°çš„æ ‡è¯†ç¬¦ï¼ˆæ¯”å¦‚ fï¼‰è¢«è§†ä¸ºåœ¨å‡½æ•°ä½“å†…æ˜¯å¯è§çš„ï¼Œå°±åƒå‡½æ•°çš„å‚æ•°ä¸€æ ·ã€‚è¿™å…è®¸å‡½æ•°ä½“å†…éƒ¨å¼•ç”¨è‡ªèº«ã€‚

5. å…·ä½“ä¾‹å­ï¼š
   è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„é€’å½’å‡½æ•°ä¾‹å­ï¼ˆä½¿ç”¨ OCaml è¯­æ³•ï¼‰ï¼š

   ```ocaml
   let rec factorial n =
     if n = 0 then 1
     else n * factorial (n - 1)
   ```

   ç±»å‹æ£€æŸ¥è¿‡ç¨‹ï¼š
   a. å‡è®¾ `factorial` çš„ç±»å‹æ˜¯ `int -> int`
   b. æ£€æŸ¥å‡½æ•°ä½“ï¼š
      - `n` è¢«ç”¨ä½œ `int`ï¼ˆä¸ 0 æ¯”è¾ƒï¼Œä¸ 1 ç›¸ä¹˜ï¼‰
      - `factorial` è¢«è°ƒç”¨æ—¶ä¼ å…¥ `int`ï¼ˆn - 1ï¼‰
      - è¿”å›å€¼æ˜¯ `int`
   c. éªŒè¯ï¼šå‡½æ•°ä½“åœ¨å‡è®¾ `factorial : int -> int` çš„æƒ…å†µä¸‹ç±»å‹æ­£ç¡®
   d. ç»“è®ºï¼šå‡è®¾æˆç«‹ï¼Œ`factorial` çš„ç±»å‹ç¡®å®æ˜¯ `int -> int`

6. ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦ï¼š
   è¿™ç§æ–¹æ³•å…è®¸ç±»å‹ç³»ç»Ÿæ­£ç¡®åœ°å¤„ç†é€’å½’å‡½æ•°ï¼Œå³ä½¿åœ¨å‡½æ•°å®šä¹‰è¿˜æœªå®Œå…¨å¤„ç†å®Œæ—¶ã€‚å®ƒä¿è¯äº†ç±»å‹å®‰å…¨ï¼ŒåŒæ—¶å…è®¸é€’å½’å®šä¹‰çš„çµæ´»æ€§ã€‚

7. åœ¨å…¶ä»–è¯­è¨€ä¸­ï¼š
   è¿™ç§æ–¹æ³•åœ¨è®¸å¤šå…·æœ‰é™æ€ç±»å‹ç³»ç»Ÿçš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­éƒ½å¾ˆå¸¸è§ï¼Œå¦‚ Haskellã€ML ç­‰ã€‚

æ€»ç»“ï¼š
è¿™ä¸ªè§„åˆ™æœ¬è´¨ä¸Šæ˜¯è¯´ï¼Œç±»å‹æ£€æŸ¥å™¨åœ¨æ£€æŸ¥é€’å½’å‡½æ•°æ—¶ï¼Œä¼šå…ˆå¯¹å‡½æ•°ç±»å‹åšä¸€ä¸ª"æ•™è‚²æ€§çš„çŒœæµ‹"ï¼Œç„¶åéªŒè¯è¿™ä¸ªçŒœæµ‹æ˜¯å¦ä¸å‡½æ•°ä½“ä¸€è‡´ã€‚è¿™å…è®¸å‡½æ•°åœ¨è‡ªå·±çš„å®šä¹‰ä¸­å¼•ç”¨è‡ªå·±ï¼ŒåŒæ—¶ä¿æŒç±»å‹çš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§ã€‚

è¿™ä¸ªæ¦‚å¿µå¯èƒ½ä¸€å¼€å§‹æœ‰ç‚¹æŠ½è±¡ï¼Œä½†å®ƒæ˜¯å¤„ç†é€’å½’å‡½æ•°ç±»å‹æ£€æŸ¥çš„å…³é”®æœºåˆ¶ã€‚æ‚¨å¯¹è¿™ä¸ªè§£é‡Šè¿˜æœ‰ä»€ä¹ˆç–‘é—®å—ï¼Ÿæˆ–è€…æ‚¨æƒ³çœ‹æ›´å¤šçš„ä¾‹å­æ¥åŠ æ·±ç†è§£ï¼Ÿ

## 2.4.2.åŒ¿åå‡½æ•°

åŒ¿åå‡½æ•°ä¹Ÿç§°ä¸º lambda è¡¨è¾¾å¼ï¼Œè¯¥æœ¯è¯­æ¥è‡ª lambda æ¼”ç®—ï¼Œå®ƒæ˜¯ä¸€ç§è®¡ç®—çš„æ•°å­¦æ¨¡å‹ï¼Œä¸å›¾çµæœºæ˜¯è®¡ç®—æ¨¡å‹çš„æ„ä¹‰ç›¸åŒã€‚åœ¨ lambda æ¼”ç®—ä¸­ï¼Œ fun x -> e å°†å†™ä½œã€‚è¡¨ç¤ºåŒ¿åå‡½æ•°ã€‚

åŠ¨æ€è¯­ä¹‰ã€‚åŒ¿åå‡½æ•°å·²ç»æ˜¯ä¸€ä¸ªå€¼ã€‚æ— éœ€æ‰§è¡Œä»»ä½•è®¡ç®—ã€‚

## 2.4.3. Function Application

e0 e1 e2 ... en

ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ e0 æ˜¯å‡½æ•°ï¼Œå®ƒåº”ç”¨äºå‚æ•° e1 åˆ° en ã€‚è¯·æ³¨æ„ï¼Œå‚æ•°å‘¨å›´ä¸éœ€è¦æ‹¬å·æ¥æŒ‡ç¤ºå‡½æ•°åº”ç”¨ç¨‹åºï¼Œå› ä¸ºå®ƒä»¬åœ¨ C ç³»åˆ—è¯­è¨€ï¼ˆåŒ…æ‹¬ Javaï¼‰ä¸­æ˜¯è¿™æ ·çš„ã€‚


å¦‚æœå°†è¿™äº›æ±‚å€¼è§„åˆ™ä¸ let è¡¨è¾¾å¼çš„è§„åˆ™è¿›è¡Œæ¯”è¾ƒï¼Œæ‚¨ä¼šå‘ç°å®ƒä»¬éƒ½æ¶‰åŠæ›¿æ¢ã€‚è¿™ä¸æ˜¯æ„å¤–ã€‚äº‹å®ä¸Šï¼Œç¨‹åºä¸­å‡ºç° let x = e1 in e2 çš„ä»»ä½•åœ°æ–¹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å°†å…¶æ›¿æ¢ä¸º (fun x -> e2) e1 ã€‚å®ƒä»¬åœ¨è¯­æ³•ä¸Šä¸åŒï¼Œä½†åœ¨è¯­ä¹‰ä¸Šç­‰æ•ˆã€‚æœ¬è´¨ä¸Šï¼Œ let è¡¨è¾¾å¼åªæ˜¯åŒ¿åå‡½æ•°åº”ç”¨çš„è¯­æ³•ç³–ã€‚



è¿™æ®µæè¿°è§£é‡Šäº† OCamlï¼ˆå’Œè®¸å¤šå…¶ä»–å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼‰ä¸­ `let` è¡¨è¾¾å¼å’Œå‡½æ•°åº”ç”¨ä¹‹é—´çš„æ·±å±‚å…³ç³»ã€‚è®©æˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š

1. `let` è¡¨è¾¾å¼çš„å½¢å¼ï¼š
   ```ocaml
   let x = e1 in e2
   ```

2. ç­‰ä»·çš„å‡½æ•°åº”ç”¨å½¢å¼ï¼š
   ```ocaml
   (fun x -> e2) e1
   ```

3. è¯­ä¹‰ç­‰ä»·æ€§ï¼š
   è¿™ä¸¤ç§å½¢å¼åœ¨è¯­ä¹‰ä¸Šæ˜¯ç­‰ä»·çš„ï¼Œæ„å‘³ç€å®ƒä»¬çš„è¡Œä¸ºå’Œç»“æœæ˜¯ç›¸åŒçš„ã€‚

4. æ›¿æ¢è§„åˆ™ï¼š
   - åœ¨ `let` è¡¨è¾¾å¼ä¸­ï¼Œ`e2` ä¸­çš„ `x` è¢« `e1` çš„å€¼æ›¿æ¢ã€‚
   - åœ¨å‡½æ•°åº”ç”¨ä¸­ï¼Œå‡½æ•°ä½“ï¼ˆå³ `e2`ï¼‰ä¸­çš„å‚æ•° `x` è¢«å‚æ•°å€¼ï¼ˆå³ `e1`ï¼‰æ›¿æ¢ã€‚

5. "è¯­æ³•ç³–"çš„æ¦‚å¿µï¼š
   ç§° `let` è¡¨è¾¾å¼ä¸ºå‡½æ•°åº”ç”¨çš„"è¯­æ³•ç³–"ï¼Œæ„å‘³ç€å®ƒæä¾›äº†ä¸€ç§æ›´ç®€æ´ã€æ›´æ˜“è¯»çš„æ–¹å¼æ¥è¡¨è¾¾ç›¸åŒçš„æ¦‚å¿µã€‚

6. å®é™…ä¾‹å­ï¼š

   è€ƒè™‘ä»¥ä¸‹ `let` è¡¨è¾¾å¼ï¼š
   ```ocaml
   let x = 5 in x * 2
   ```

   è¿™ç­‰ä»·äºä»¥ä¸‹å‡½æ•°åº”ç”¨ï¼š
   ```ocaml
   (fun x -> x * 2) 5
   ```

   ä¸¤è€…éƒ½ä¼šè®¡ç®—å‡ºç»“æœ 10ã€‚

7. ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦ï¼š
   - ç†è§£è¿™ç§ç­‰ä»·æ€§æœ‰åŠ©äºæ·±å…¥ç†è§£è¯­è¨€çš„æ ¸å¿ƒæ¦‚å¿µã€‚
   - å®ƒå±•ç¤ºäº†å‡½æ•°å’Œç»‘å®šä¹‹é—´çš„ç´§å¯†å…³ç³»ã€‚
   - åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥æ ¹æ®éœ€è¦åœ¨è¿™ä¸¤ç§å½¢å¼ä¹‹é—´è½¬æ¢ã€‚

8. åœ¨å…¶ä»–ä¸Šä¸‹æ–‡ä¸­çš„åº”ç”¨ï¼š
   è¿™ç§ç†è§£ä¹Ÿå¯ä»¥æ‰©å±•åˆ°å…¶ä»–ç»“æ„ï¼Œä¾‹å¦‚ï¼š
   ```ocaml
   let f x = x + 1 in f 3
   ```
   å¯ä»¥çœ‹ä½œæ˜¯ï¼š
   ```ocaml
   (fun f -> f 3) (fun x -> x + 1)
   ```

9. æ±‚å€¼é¡ºåºï¼š
   è¿™ç§ç­‰ä»·æ€§ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆåœ¨ `let x = e1 in e2` ä¸­ï¼Œ`e1` æ€»æ˜¯åœ¨ `e2` ä¹‹å‰æ±‚å€¼ã€‚

10. å±€é™æ€§ï¼š
    è™½ç„¶åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¿™ç§ç­‰ä»·æ€§æˆç«‹ï¼Œä½†åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼ˆå¦‚æ¶‰åŠé€’å½’å®šä¹‰æ—¶ï¼‰ï¼Œå¯èƒ½ä¼šæœ‰ç»†å¾®å·®åˆ«ã€‚

ç†è§£è¿™ç§ç­‰ä»·æ€§æœ‰åŠ©äºï¼š
- æ›´æ·±å…¥åœ°ç†è§£è¯­è¨€çš„å·¥ä½œåŸç†
- åœ¨éœ€è¦æ—¶è¿›è¡Œä»£ç é‡æ„
- ç†è§£æ›´å¤æ‚çš„è¯­è¨€ç‰¹æ€§ï¼ˆå¦‚æ¨¡å¼åŒ¹é…ï¼‰æ˜¯å¦‚ä½•å»ºç«‹åœ¨è¿™äº›åŸºæœ¬æ¦‚å¿µä¹‹ä¸Šçš„

è¿™ä¸ªæ¦‚å¿µç¡®å®æœ‰ç‚¹æŠ½è±¡ï¼Œä½†å®ƒæ­ç¤ºäº†å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€çš„ä¸€äº›æ ¸å¿ƒè®¾è®¡åŸåˆ™ã€‚æ‚¨å¯¹è¿™ä¸ªè§£é‡Šè¿˜æœ‰ä»€ä¹ˆç–‘é—®å—ï¼Ÿæˆ–è€…æ‚¨æƒ³çœ‹ä¸€äº›æ›´å¤æ‚çš„ä¾‹å­æ¥è¿›ä¸€æ­¥ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Ÿ

##  2.4.4.ç®¡é“

OCaml ä¸­æœ‰ä¸€ä¸ªå†…ç½®çš„ç”¨äºå‡½æ•°åº”ç”¨çš„ä¸­ç¼€è¿ç®—ç¬¦ï¼Œç§°ä¸ºç®¡é“è¿ç®—ç¬¦ï¼Œå†™ä¸º |> ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæç»˜ä¸€ä¸ªæŒ‡å‘å³ä¾§çš„ä¸‰è§’å½¢ã€‚æ¯”å–»æ˜¯å€¼é€šè¿‡ç®¡é“ä»å·¦åˆ°å³å‘é€ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸Šé¢çš„å¢é‡å‡½æ•° inc ä»¥åŠå¯¹å…¶è¾“å…¥æ±‚å¹³æ–¹çš„å‡½æ•° square ï¼š

```ocaml
let inc x = x + 1;;
let square x = x * x;;
```

```ocaml
square (inc 5);;
5 |> inc |> square;;
```

ç”±äº e1 |> e2 åªæ˜¯ e2 e1 çš„å¦ä¸€ç§ç¼–å†™æ–¹å¼ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦å£°æ˜ |> çš„è¯­ä¹‰ï¼šå®ƒä¸å‡½æ•°åº”ç”¨ç¨‹åºç›¸åŒã€‚è¿™ä¸¤ä¸ªç¨‹åºæ˜¯è¯­æ³•ä¸Šä¸åŒä½†è¯­ä¹‰ä¸Šç­‰æ•ˆçš„è¡¨è¾¾å¼çš„å¦ä¸€ä¸ªç¤ºä¾‹ã€‚

è¿™æ®µæè¿°è§£é‡Šäº†OCamlä¸­ç®¡é“æ“ä½œç¬¦ `|>` çš„æœ¬è´¨ã€‚è®©æˆ‘è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š

1. ç®¡é“æ“ä½œç¬¦ `|>` çš„å®šä¹‰ï¼š
   `e1 |> e2` ç­‰ä»·äº `e2 e1`

2. è¯­æ³•å·®å¼‚ï¼Œè¯­ä¹‰ç­‰ä»·ï¼š
   è¿™ä¸¤ç§å†™æ³•åœ¨è¯­æ³•ï¼ˆhow it's writtenï¼‰ä¸Šä¸åŒï¼Œä½†åœ¨è¯­ä¹‰ï¼ˆwhat it meansï¼‰ä¸Šæ˜¯å®Œå…¨ç›¸åŒçš„ã€‚

3. å‡½æ•°åº”ç”¨çš„å¦ä¸€ç§è¡¨ç¤ºï¼š
   `|>` æœ¬è´¨ä¸Šåªæ˜¯å‡½æ•°åº”ç”¨çš„å¦ä¸€ç§å†™æ³•ï¼Œä¸éœ€è¦æ–°çš„è¯­ä¹‰è§„åˆ™æ¥è§£é‡Šå®ƒã€‚

4. å®é™…ä¾‹å­ï¼š
   ```ocaml
   (* ä½¿ç”¨ç®¡é“æ“ä½œç¬¦ *)
   5 |> (fun x -> x * 2)

   (* ç­‰ä»·çš„æ™®é€šå‡½æ•°åº”ç”¨ *)
   (fun x -> x * 2) 5
   ```
   è¿™ä¸¤ç§å†™æ³•éƒ½ä¼šå¾—åˆ°ç»“æœ 10ã€‚

5. ç®¡é“æ“ä½œç¬¦çš„ä¼˜åŠ¿ï¼š
   - æé«˜å¯è¯»æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šä¸ªå‡½æ•°è¿ç»­åº”ç”¨æ—¶
   - ä½¿ä»£ç æŒ‰ç…§æ•°æ®æµçš„é¡ºåºä»å·¦åˆ°å³é˜…è¯»
   - å‡å°‘æ‹¬å·çš„ä½¿ç”¨

6. å¤šä¸ªç®¡é“æ“ä½œçš„ä¾‹å­ï¼š
   ```ocaml
   (* ä½¿ç”¨ç®¡é“æ“ä½œç¬¦ *)
   5 |> (fun x -> x * 2) |> (fun x -> x + 3)

   (* ç­‰ä»·çš„åµŒå¥—å‡½æ•°åº”ç”¨ *)
   (fun x -> x + 3) ((fun x -> x * 2) 5)
   ```

7. åœ¨å®é™…ç¼–ç¨‹ä¸­çš„åº”ç”¨ï¼š
   ç®¡é“æ“ä½œç¬¦ç‰¹åˆ«é€‚åˆå¤„ç†æ•°æ®è½¬æ¢æµç¨‹ï¼Œä½¿ä»£ç æ›´æ˜“è¯»å’Œç†è§£ï¼š

   ```ocaml
   let result =
     [1; 2; 3; 4; 5]
     |> List.map (fun x -> x * 2)
     |> List.filter (fun x -> x > 5)
     |> List.fold_left (+) 0
   ```

   è¿™æ¯”åµŒå¥—çš„å‡½æ•°è°ƒç”¨æ›´æ˜“è¯»ï¼š

   ```ocaml
   let result =
     List.fold_left (+) 0
       (List.filter (fun x -> x > 5)
         (List.map (fun x -> x * 2) [1; 2; 3; 4; 5]))
   ```

8. è¯­è¨€è®¾è®¡çš„æ´å¯Ÿï¼š
   è¿™ä¸ªç‰¹æ€§å±•ç¤ºäº†å¦‚ä½•é€šè¿‡å¼•å…¥æ–°çš„è¯­æ³•æ¥æ”¹å–„ä»£ç çš„å¯è¯»æ€§ï¼Œè€Œä¸éœ€è¦æ”¹å˜è¯­è¨€çš„æ ¸å¿ƒè¯­ä¹‰ã€‚

9. ç±»ä¼¼æ¦‚å¿µåœ¨å…¶ä»–è¯­è¨€ä¸­ï¼š
   - F# ä¹Ÿæœ‰ç±»ä¼¼çš„ `|>` æ“ä½œç¬¦
   - Elixir ä½¿ç”¨ `|>` ä½œä¸ºç®¡é“æ“ä½œç¬¦
   - Haskell æœ‰ç±»ä¼¼åŠŸèƒ½çš„ `$` æ“ä½œç¬¦ï¼ˆè™½ç„¶æ–¹å‘ç›¸åï¼‰

ç†è§£ `|>` å’Œæ™®é€šå‡½æ•°åº”ç”¨çš„ç­‰ä»·æ€§æœ‰åŠ©äºï¼š
- æ›´çµæ´»åœ°ç»„ç»‡å’Œé‡æ„ä»£ç 
- ç†è§£å‡½æ•°å¼ç¼–ç¨‹ä¸­æ•°æ®æµçš„æ¦‚å¿µ
- æ¬£èµè¯­è¨€è®¾è®¡ä¸­è¯­æ³•ç³–çš„ä½œç”¨

è¿™ä¸ªç‰¹æ€§æ˜¯OCamlï¼ˆå’Œå…¶ä»–ä¸€äº›å‡½æ•°å¼è¯­è¨€ï¼‰æé«˜ä»£ç å¯è¯»æ€§å’Œè¡¨è¾¾èƒ½åŠ›çš„å¥½ä¾‹å­ã€‚æ‚¨å¯¹è¿™ä¸ªè§£é‡Šè¿˜æœ‰ä»€ä¹ˆç–‘é—®å—ï¼Ÿæˆ–è€…æ‚¨æƒ³çœ‹ä¸€äº›æ›´å¤æ‚çš„ä½¿ç”¨ç®¡é“æ“ä½œç¬¦çš„ä¾‹å­ï¼Ÿ

## 2.4.5ã€‚å¤šæ€å‡½æ•° #

å¤šæ€å‡½æ•°æ˜¯å¯ä»¥æ¥å—å¤šç§ç±»å‹çš„å‚æ•°çš„å‡½æ•°ã€‚åœ¨OCamlä¸­ï¼Œå¤šæ€å‡½æ•°å¯ä»¥é€šè¿‡ç±»å‹å˜é‡æ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹å‡½æ•°ï¼š

```ocaml
let id x = x;;
```
val id : 'a -> 'a = <fun>

'a æ˜¯ä¸€ä¸ªç±»å‹å˜é‡ï¼šå®ƒä»£è¡¨æœªçŸ¥ç±»å‹ï¼Œå°±åƒå¸¸è§„å˜é‡ä»£è¡¨æœªçŸ¥å€¼ä¸€æ ·ã€‚ç±»å‹å˜é‡å§‹ç»ˆä»¥å•å¼•å·å¼€å¤´ã€‚å¸¸ç”¨çš„ç±»å‹å˜é‡åŒ…æ‹¬ 'a ã€ 'b å’Œ 'c ï¼ŒOCaml ç¨‹åºå‘˜é€šå¸¸ç”¨å¸Œè…Šè¯­å‘éŸ³ï¼šalphaã€beta å’Œ gammaã€‚

å› ä¸ºæ‚¨å¯ä»¥å°† id åº”ç”¨äºå¤šç§ç±»å‹çš„å€¼ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªå¤šæ€å‡½æ•°ï¼šå®ƒå¯ä»¥åº”ç”¨äºå¤šç§ï¼ˆå¤šï¼‰å½¢å¼ï¼ˆmorphï¼‰ã€‚

é€šè¿‡æ‰‹åŠ¨ç±»å‹æ³¨é‡Šï¼Œå¯ä»¥ä¸ºå¤šæ€å‡½æ•°æä¾›æ¯”ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­çš„ç±»å‹æ›´å…·é™åˆ¶æ€§çš„ç±»å‹ã€‚

```ocaml
let id : 'a -> 'a = fun x -> x;;
let id_int : int -> int = id;;
```
